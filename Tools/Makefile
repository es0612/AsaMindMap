# AsaMindMap Makefile

.PHONY: help build test clean format lint setup

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
help:
	@echo "AsaMindMap é–‹ç™ºç”¨ã‚³ãƒãƒ³ãƒ‰:"
	@echo "  setup   - é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
	@echo "  build   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰"
	@echo "  test    - ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ"
	@echo "  format  - ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (SwiftFormat)"
	@echo "  lint    - ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ (SwiftLint)"
	@echo "  clean   - ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢"

# é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup:
	@echo "ğŸ“¦ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºä¸­..."
	cd Package && swift package resolve
	@echo "âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†"

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰
build:
	@echo "ğŸ”¨ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ä¸­..."
	cd Package && swift build
	@echo "âœ… ãƒ“ãƒ«ãƒ‰å®Œäº†"

# ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
test:
	@echo "ğŸ§ª ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­..."
	cd Package && swift test
	@echo "âœ… ãƒ†ã‚¹ãƒˆå®Œäº†"

# ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰
build-app:
	@echo "ğŸ”¨ iOSã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ä¸­..."
	cd App && xcodebuild -project AsaMindMap.xcodeproj -scheme AsaMindMap -destination 'platform=iOS Simulator,name=iPhone 16' build
	@echo "âœ… ã‚¢ãƒ—ãƒªãƒ“ãƒ«ãƒ‰å®Œäº†"

# ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
format:
	@echo "ğŸ¨ ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸­..."
	@if command -v swiftformat >/dev/null 2>&1; then \
		swiftformat Package/Sources Package/Tests App/AsaMindMap --config Tools/.swiftformat; \
		echo "âœ… ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®Œäº†"; \
	else \
		echo "âš ï¸  SwiftFormatãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“"; \
		echo "   ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«: brew install swiftformat"; \
	fi

# ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
lint:
	@echo "ğŸ” ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ãƒã‚§ãƒƒã‚¯ä¸­..."
	@if command -v swiftlint >/dev/null 2>&1; then \
		swiftlint --config Tools/.swiftlint.yml Package/Sources Package/Tests App/AsaMindMap; \
		echo "âœ… Lintå®Œäº†"; \
	else \
		echo "âš ï¸  SwiftLintãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“"; \
		echo "   ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«: brew install swiftlint"; \
	fi

# è‡ªå‹•ä¿®æ­£å¯èƒ½ãªLintã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£
lint-fix:
	@echo "ğŸ”§ Lintã‚¨ãƒ©ãƒ¼ã‚’è‡ªå‹•ä¿®æ­£ä¸­..."
	@if command -v swiftlint >/dev/null 2>&1; then \
		swiftlint --fix --config Tools/.swiftlint.yml Package/Sources Package/Tests App/AsaMindMap; \
		echo "âœ… è‡ªå‹•ä¿®æ­£å®Œäº†"; \
	else \
		echo "âš ï¸  SwiftLintãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“"; \
	fi

# ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢
clean:
	@echo "ğŸ§¹ ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ä¸­..."
	swift package clean
	rm -rf .build
	@echo "âœ… ã‚¯ãƒªã‚¢å®Œäº†"

# å…¨ä½“çš„ãªå“è³ªãƒã‚§ãƒƒã‚¯
check: lint test
	@echo "âœ… å…¨ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸ"

# é–‹ç™ºç”¨ã®å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
dev: format lint test
	@echo "âœ… é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®Œäº†ã—ã¾ã—ãŸ"

# å…¨ä½“ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
clean:
	@echo "ğŸ§¹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­..."
	cd Package && swift package clean
	cd App && xcodebuild clean -project AsaMindMap.xcodeproj -scheme AsaMindMap
	rm -rf Package/.build App/DerivedData
	@echo "âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†"